<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Karpenter – AWS</title>
    <link>/v0.5.3-docs/aws/</link>
    <description>Recent content in AWS on Karpenter</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="/v0.5.3-docs/aws/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>V0.5.3-Docs: Provisioning Configuration</title>
      <link>/v0.5.3-docs/aws/provisioning/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/v0.5.3-docs/aws/provisioning/</guid>
      <description>
        
        
        &lt;h2 id=&#34;specprovider&#34;&gt;spec.provider&lt;/h2&gt;
&lt;p&gt;This section covers parameters of the AWS Cloud Provider.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/awslabs/karpenter/blob/main/pkg/cloudprovider/aws/apis/v1alpha1/provider.go#L33&#34;&gt;Review these fields in the code.&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;instanceprofile&#34;&gt;InstanceProfile&lt;/h3&gt;
&lt;p&gt;An &lt;code&gt;InstanceProfile&lt;/code&gt; is a way to pass a single IAM role to an EC2 instance.&lt;/p&gt;
&lt;p&gt;It is required, and specified by name. A suitable &lt;code&gt;KarpenterNodeRole&lt;/code&gt; is created in the getting started guide.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;spec:
  provider:
    instanceProfile: MyInstanceProfile
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;launchtemplate&#34;&gt;LaunchTemplate&lt;/h3&gt;
&lt;p&gt;A launch template is a set of configuration values sufficient for launching an EC2 instance (e.g., AMI, storage spec).&lt;/p&gt;
&lt;p&gt;A custom launch template is specified by name. If none is specified, Karpenter will automatically create a launch template.&lt;/p&gt;
&lt;p&gt;Review the &lt;a href=&#34;../launch-templates/&#34;&gt;Launch Template documentation&lt;/a&gt; to learn how to create a custom one.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;spec:
  provider:
    launchTemplate: MyLaunchTemplate
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;subnetselector&#34;&gt;SubnetSelector&lt;/h3&gt;
&lt;p&gt;Karpenter discovers subnets using &lt;a href=&#34;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html&#34;&gt;AWS tags&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Subnets may be specified by any AWS tag, including &lt;code&gt;Name&lt;/code&gt;. Selecting tag values using wildcards (&amp;quot;*&amp;quot;) is supported.&lt;/p&gt;
&lt;p&gt;When launching nodes, Karpenter automatically chooses a subnet that matches the desired zone. If multiple subnets exist for a zone, one is chosen randomly.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Examples&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Select all subnets with a specified tag:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  subnetSelector:
    kubernetes.io/cluster/MyCluster: &#39;*&#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Select subnets by name:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  subnetSelector:
    Name: subnet-0fcd7006b3754e95e
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Select subnets by an arbitrary AWS tag key/value pair:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  subnetSelector:
    MySubnetTag: value
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Select subnets using wildcards:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  subnetSelector:
    Name: *public*

&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;securitygroupselector&#34;&gt;SecurityGroupSelector&lt;/h3&gt;
&lt;p&gt;The security group of an instance is comparable to a set of firewall rules.
If no security groups are explicitly listed, Karpenter discovers them using the tag &amp;ldquo;kubernetes.io/cluster/MyClusterName&amp;rdquo;, similar to subnet discovery.&lt;/p&gt;
&lt;p&gt;EKS creates at least two security groups by default, &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html&#34;&gt;review the documentation&lt;/a&gt; for more info.&lt;/p&gt;
&lt;p&gt;Security groups may be specified by any AWS tag, including &amp;ldquo;name&amp;rdquo;. Selecting tags using wildcards (&amp;quot;*&amp;quot;) is supported.&lt;/p&gt;
&lt;p&gt;‼️ When launching nodes, Karpenter uses all of the security groups that match the selector. If multiple security groups with the tag &lt;code&gt;kubernetes.io/cluster/MyClusterName&lt;/code&gt; match the selector, this may result in failures using the AWS Load Balancer controller. The Load Balancer controller only supports a single security group having that tag key. See this &lt;a href=&#34;https://github.com/kubernetes-sigs/aws-load-balancer-controller/issues/2367&#34;&gt;issue&lt;/a&gt; for more details.&lt;/p&gt;
&lt;p&gt;To verify if this restriction affects you, run the following commands.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color:#000&#34;&gt;CLUSTER_VPC_ID&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;$(&lt;/span&gt;aws eks describe-cluster --name &lt;span style=&#34;color:#000&#34;&gt;$CLUSTER_NAME&lt;/span&gt; --query cluster.resourcesVpcConfig.vpcId --output text&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;&lt;/span&gt;

aws ec2 describe-security-groups --filters &lt;span style=&#34;color:#000&#34;&gt;Name&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;vpc-id,Values&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;$CLUSTER_VPC_ID&lt;/span&gt; &lt;span style=&#34;color:#000&#34;&gt;Name&lt;/span&gt;&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;tag-key,Values&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;=&lt;/span&gt;kubernetes.io/cluster/&lt;span style=&#34;color:#000&#34;&gt;$CLUSTER_NAME&lt;/span&gt; --query SecurityGroups&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;[]&lt;/span&gt;.&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;[&lt;/span&gt;GroupName&lt;span style=&#34;color:#ce5c00;font-weight:bold&#34;&gt;]&lt;/span&gt; --output text
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If multiple securityGroups are printed, you will need a more targeted securityGroupSelector.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Examples&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Select all security groups with a specified tag:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;spec:
  provider:
    securityGroupSelector:
      kubernetes.io/cluster/MyKarpenterSecurityGroups: &#39;*&#39;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Select security groups by name, or another tag:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; securityGroupSelector:
   Name: sg-01077157b7cf4f5a8
   MySecurityTag: &#39;&#39; # matches all resources with the tag
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Select security groups by name using a wildcard:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; securityGroupSelector:
   Name: *public*
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;tags&#34;&gt;Tags&lt;/h3&gt;
&lt;p&gt;Tags will be added to every EC2 Instance launched by this provisioner.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;spec:
  provider:
    tags:
      InternalAccountingTag: 1234
      dev.corp.net/app: Calculator
      dev.corp.net/team: MyTeam
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note: Karpenter will set the default AWS tags listed below, but these can be overridden in the tags section above.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Name: karpenter.sh/cluster/&amp;lt;cluster-name&amp;gt;/provisioner/&amp;lt;provisioner-name&amp;gt;
karpenter.sh/cluster/&amp;lt;cluster-name&amp;gt;: owned
kubernetes.io/cluster/&amp;lt;cluster-name&amp;gt;: owned
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;other-resources&#34;&gt;Other Resources&lt;/h2&gt;
&lt;h3 id=&#34;accelerators-gpu&#34;&gt;Accelerators, GPU&lt;/h3&gt;
&lt;p&gt;Accelerator (e.g., GPU) values include&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;nvidia.com/gpu&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;amd.com/gpu&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;aws.amazon.com/neuron&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Karpenter supports accelerators, such as GPUs.&lt;/p&gt;
&lt;p&gt;Additionally, include a resource requirement in the workload manifest. This will cause the GPU dependent pod will be scheduled onto the appropriate node.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Accelerator resource in workload manifest (e.g., pod)&lt;/em&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;spec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;template&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;spec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;containers&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;- &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;resources&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;          &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;limits&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;nvidia.com/gpu&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
    <item>
      <title>V0.5.3-Docs: Launch Templates and Custom Images</title>
      <link>/v0.5.3-docs/aws/launch-templates/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/v0.5.3-docs/aws/launch-templates/</guid>
      <description>
        
        
        &lt;p&gt;By default, Karpenter generates launch templates that use &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/eks-optimized-ami.html&#34;&gt;EKS Optimized AMI&lt;/a&gt; for nodes. Often, users need to customize the node image to integrate with existing infrastructure or meet compliance requirements. Karpenter supports custom node images through Launch Templates. If you need to customize the node, then you need a custom launch template.&lt;/p&gt;
&lt;p&gt;Note: By customizing the image, you are taking responsibility for maintaining the image, including security updates. In the default configuration, Karpenter will use the latest version of the EKS optimized AMI, which is maintained by AWS.&lt;/p&gt;
&lt;h2 id=&#34;introduction&#34;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Karpenter follows existing AWS patterns for customizing the base image of
instances. More specifically, Karpenter uses &lt;a href=&#34;https://docs.aws.amazon.com/autoscaling/ec2/userguide/LaunchTemplates.html&#34;&gt;EC2 launch templates&lt;/a&gt;. Launch
templates may specify many values. The pivotal value is the base image (AMI).
Launch templates further specify many different parameters related to networking, authorization, instance type, and more.&lt;/p&gt;
&lt;p&gt;Launch Templates and AMIs are unique to AWS regions, similar to EKS clusters. IAM resources are global.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Karpenter only implements a subset of launch template fields, and some fields should not be set.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;This guide describes requirements for using launch templates with Karpenter, and later an example procedure.&lt;/p&gt;
&lt;h2 id=&#34;launch-template-requirements&#34;&gt;Launch Template Requirements&lt;/h2&gt;
&lt;p&gt;The Launch Template resource includes a large number of fields. AWS accepts launch templates with any subset of these fields defined.&lt;/p&gt;
&lt;p&gt;Certain fields are obviously critical, such as AMI and User Data. Some fields are useful for particular workloads, such as storage and IAM Instance Profile.&lt;/p&gt;
&lt;p&gt;Finally, &lt;strong&gt;the majority of Launch Template fields should not be set&lt;/strong&gt; (or will have no effect), such as network interfaces and instance type.&lt;/p&gt;
&lt;h2 id=&#34;important-fields&#34;&gt;Important Fields&lt;/h2&gt;
&lt;p&gt;When creating a custom launch template, the AMI and User Data are the defining characteristics. Instance Profile (IAM Role) and Security Group (firewall rules) are also important for Karpenter.&lt;/p&gt;
&lt;h3 id=&#34;ami&#34;&gt;AMI&lt;/h3&gt;
&lt;p&gt;AMI (Amazon Machine Image), is the base image/VM for a launch template.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/vm-import/latest/userguide/vmimport-image-import.html&#34;&gt;Review the instructions for importing a VM to AWS.&lt;/a&gt; Note the AMI id generated by this process, such as,
&lt;code&gt;ami-074cce78125f09d61&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id=&#34;user-data---autoconfigure&#34;&gt;User Data - Autoconfigure&lt;/h3&gt;
&lt;p&gt;Importantly, the AMI must support automatically connecting to a cluster based
on &amp;ldquo;user data&amp;rdquo;, or a base64 encoded string passed to the instance at startup.
The syntax and purpose of the user data varies between images. The Karpenter
default OS, Amazon Linux 2 (AL2), accepts shell scripts (bash commands).&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html#user-data-shell-scripts&#34;&gt;AWS calls data passed to an instance at launch time &amp;ldquo;user
data&amp;rdquo;.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;In the default configuration, Karpenter uses an EKS optimized version of AL2 and passes the hostname of the Kubernetes API server, and a certificate. The EKS Optimized AMI includes a &lt;code&gt;bootstrap.sh&lt;/code&gt; script which connects the instance to the cluster, based on the passed data.&lt;/p&gt;
&lt;p&gt;Alternatively, you may reference AWS&amp;rsquo;s &lt;a href=&#34;https://github.com/awslabs/amazon-eks-ami/blob/master/files/bootstrap.sh&#34;&gt;&lt;code&gt;bootstrap.sh&lt;/code&gt;
file&lt;/a&gt;
when building a custom base image.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#!/bin/bash
/etc/eks/bootstrap.sh &amp;lt;my-cluster-name&amp;gt; \
--kubelet-extra-args &amp;lt;&#39;--max-pods=40&#39;&amp;gt; \
--b64-cluster-ca &amp;lt;certificateAuthority&amp;gt; \
--apiserver-endpoint &amp;lt;endpoint&amp;gt; \
--dns-cluster-ip &amp;lt;serviceIpv4Cidr&amp;gt; \
--use-max-pods false
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note, you must populate this command with live values. Karpenter will
not change the user data in the launch template.&lt;/p&gt;
&lt;p&gt;Encode using yaml function &lt;code&gt;!Base64&lt;/code&gt; yaml function or &lt;code&gt;cat userdata.sh | base64 &amp;gt; userdata-encoded.txt&lt;/code&gt; shell command.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Bootstrap Script Parameters&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The sample bootstrap script requires information to join the cluster.&lt;/p&gt;
&lt;p&gt;These values may be found using:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;aws eks describe-cluster --name MyKarpenterCluster
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;Kubelet Arguments&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Specifying max-pods can break Karpenter&amp;rsquo;s binpacking logic (it has no way to know what this setting is). If Karpenter attempts to pack more than this number of pods, the instance may be oversized, and additional pods will reschedule.&lt;/p&gt;
&lt;h2 id=&#34;situational-fields&#34;&gt;Situational Fields&lt;/h2&gt;
&lt;p&gt;Configure these values in response to a particular use case, such as nodes interacting with another AWS service, or using EBS storage on the node.&lt;/p&gt;
&lt;h3 id=&#34;instance-profile---iam&#34;&gt;Instance Profile - IAM&lt;/h3&gt;
&lt;p&gt;The launch template must include an &amp;ldquo;instance profile&amp;rdquo; &amp;ndash; an IAM role.&lt;/p&gt;
&lt;p&gt;The instance profile must include &lt;em&gt;at least&lt;/em&gt; the permissions of the default Karpenter node instance profile. See the default role, &lt;code&gt;KarpenterNodeRole&lt;/code&gt;, in the full example below for more information.&lt;/p&gt;
&lt;p&gt;See also, &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/security-iam-awsmanpol.html#security-iam-awsmanpol-AmazonEKSWorkerNodePolicy&#34;&gt;the managed policy &amp;ldquo;AmazonEKSWorkerNodePolicy&amp;rdquo;&lt;/a&gt; which includes permission to describe clusters and subnets.&lt;/p&gt;
&lt;h3 id=&#34;storage&#34;&gt;Storage&lt;/h3&gt;
&lt;p&gt;Karpenter expects nothing of node storage. Configure as needed for your base
image.&lt;/p&gt;
&lt;h3 id=&#34;security-groups---firewall&#34;&gt;Security Groups - Firewall&lt;/h3&gt;
&lt;p&gt;The launch template may include a security group (i.e., instance firewall rules) and the security group must be associated with the virtual private cloud (VPC) of the EKS cluster. If none is specified, the default security group of the cluster VPC is used.&lt;/p&gt;
&lt;p&gt;The security group must permit communication with EKS control plane. Outbound access should be permitted for at least: HTTPS on port 443, DNS (UDP and TCP) on port 53, and your subnet&amp;rsquo;s network access control list (network ACL).&lt;/p&gt;
&lt;h2 id=&#34;fields-with-undefined-behavior&#34;&gt;Fields with Undefined Behavior&lt;/h2&gt;
&lt;p&gt;Resources referenced by these fields are controlled by EKS/Karpenter, and not the launch template.&lt;/p&gt;
&lt;h3 id=&#34;instance-type&#34;&gt;Instance Type&lt;/h3&gt;
&lt;p&gt;The instance type should not be specified in the launch template. Karpenter
will determine the launch template at run time.&lt;/p&gt;
&lt;h3 id=&#34;network-interfaces&#34;&gt;Network Interfaces&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&#34;https://docs.aws.amazon.com/eks/latest/userguide/pod-networking.html&#34;&gt;AWS CNI&lt;/a&gt; will configure the network interfaces. Do not configure network instances in the launch template.&lt;/p&gt;
&lt;h2 id=&#34;creating-the-launch-template&#34;&gt;Creating the Launch Template&lt;/h2&gt;
&lt;p&gt;Launch Templates may be created via the web console, the AWS CLI, or
CloudFormation.&lt;/p&gt;
&lt;h3 id=&#34;cloudformation&#34;&gt;CloudFormation&lt;/h3&gt;
&lt;p&gt;The procedure, in summary, is to:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.aws.amazon.com/vm-import/latest/userguide/vmimport-image-import.html&#34;&gt;Create an AMI as described in the EC2 documentation.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Write a EC2 Launch Template specification including the AMI.&lt;/li&gt;
&lt;li&gt;Push the specification to AWS with CloudFormation.&lt;/li&gt;
&lt;li&gt;Update the Provisioner CRD to specify the new Launch Template.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;An example yaml cloudformation definition of a launch template for Karpenter is
provided below.&lt;/p&gt;
&lt;p&gt;CloudFormation yaml is suited for the moderately high configuration density of
launch templates, and creating the unusual InstanceProfile resource.&lt;/p&gt;
&lt;p&gt;You must manually replace these values in the template:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SecurityGroupID
&lt;ul&gt;
&lt;li&gt;list all security groups with &lt;code&gt;aws ec2 describe-security-groups&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Parameters in UserData&lt;/li&gt;
&lt;li&gt;AMI&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;AWSTemplateFormatVersion&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#39;2010-09-09&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Resources&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# create InstanceProfile wrapper on NodeRole&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;KarpenterNodeInstanceProfile&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Type&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;AWS::IAM::InstanceProfile&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Properties&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;InstanceProfileName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;KarpenterNodeInstanceProfile&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Path&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Roles&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;- &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Ref&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;KarpenterNodeRole&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# create role with basic permissions for EKS node&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;KarpenterNodeRole&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Type&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;AWS::IAM::Role&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Properties&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;RoleName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;KarpenterNodeRole&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Path&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;/&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;AssumeRolePolicyDocument&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Version&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;2012-10-17&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Statement&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;          &lt;/span&gt;- &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Effect&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Allow&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Principal&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;              &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Service&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;                &lt;/span&gt;!&lt;span style=&#34;color:#000&#34;&gt;Sub &amp;#34;ec2.${AWS::URLSuffix}&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Action&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;              &lt;/span&gt;- &lt;span style=&#34;color:#4e9a06&#34;&gt;&amp;#34;sts:AssumeRole&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;ManagedPolicyArns&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;- !&lt;span style=&#34;color:#000&#34;&gt;Sub &amp;#34;arn:${AWS::Partition}:iam::aws:policy/AmazonEKSWorkerNodePolicy&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;- !&lt;span style=&#34;color:#000&#34;&gt;Sub &amp;#34;arn:${AWS::Partition}:iam::aws:policy/AmazonEKS_CNI_Policy&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;- !&lt;span style=&#34;color:#000&#34;&gt;Sub &amp;#34;arn:${AWS::Partition}:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;- !&lt;span style=&#34;color:#000&#34;&gt;Sub &amp;#34;arn:${AWS::Partition}:iam::aws:policy/AmazonSSMManagedInstanceCore&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;MyLaunchTemplate&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Type&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;AWS::EC2::LaunchTemplate&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Properties&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;LaunchTemplateData&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;IamInstanceProfile&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;          &lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# Get ARN of InstanceProfile defined above&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;          &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Arn&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;!&lt;span style=&#34;color:#000&#34;&gt;GetAtt&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;- &lt;span style=&#34;color:#000&#34;&gt;KarpenterNodeInstanceProfile&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;- &lt;span style=&#34;color:#000&#34;&gt;Arn&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;ImageId&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;ami-074cce78125f09d61&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# UserData is Base64 Encoded&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;UserData&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;!&lt;span style=&#34;color:#000&#34;&gt;Base64 &amp;gt;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;#!/bin/bash&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;/etc/eks/bootstrap.sh &amp;#39;MyClusterName&amp;#39; \&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;--&lt;span style=&#34;color:#000&#34;&gt;kubelet-extra-args &amp;#39;--node-labels=node.k8s.aws/capacity-type=spot&amp;#39; \&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;--&lt;span style=&#34;color:#000&#34;&gt;b64-cluster-ca &amp;#39;LS0t....0tCg==&amp;#39; \&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;--&lt;span style=&#34;color:#000&#34;&gt;apiserver-endpoint &amp;#39;https://B0385BE29EA792E811CB5866D23C856E.gr7.us-east-2.eks.amazonaws.com&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;BlockDeviceMappings&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;          &lt;/span&gt;- &lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;Ebs&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;              &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;VolumeSize&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#0000cf;font-weight:bold&#34;&gt;80&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;              &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;VolumeType&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;gp3&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;            &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;DeviceName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;/dev/xvda&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#8f5902;font-style:italic&#34;&gt;# The SecurityGroup must be associated with the cluster VPC&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;SecurityGroupIds&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;          &lt;/span&gt;- &lt;span style=&#34;color:#000&#34;&gt;sg-a69adfdb&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;LaunchTemplateName&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;KarpenterCustomLaunchTemplate&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Create the Launch Template by uploading the CloudFormation yaml file. The
sample yaml creates an IAM Object (InstanceProfile), so &lt;code&gt;--capabilities CAPABILITY_NAMED_IAM&lt;/code&gt; must be indicated.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;aws cloudformation create-stack \
  --stack-name KarpenterLaunchTemplateStack \
  --template-body file://$(pwd)/lt-cfn-demo.yaml \
  --capabilities CAPABILITY_NAMED_IAM
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;define-launchtemplate-for-provisioner&#34;&gt;Define LaunchTemplate for Provisioner&lt;/h3&gt;
&lt;p&gt;The LaunchTemplate is ready to be used. Specify it by name in the &lt;a href=&#34;../../provisioner/&#34;&gt;Provisioner
CRD&lt;/a&gt;. Karpenter will use this template when creating new instances.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;apiVersion&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;karpenter.sh/v1alpha5&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;Provisioner&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;spec&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;  &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;provider&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#204a87;font-weight:bold&#34;&gt;launchTemplate&lt;/span&gt;&lt;span style=&#34;color:#000;font-weight:bold&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#000&#34;&gt;CustomKarpenterLaunchTemplateDemo&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#f8f8f8;text-decoration:underline&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
      </description>
    </item>
    
  </channel>
</rss>
